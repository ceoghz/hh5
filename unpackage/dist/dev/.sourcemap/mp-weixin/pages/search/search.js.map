{"version":3,"sources":["webpack:///C:/Users/love/Desktop/h52/pages/search/search.vue?c3d4","uni-app:///main.js","webpack:///C:/Users/love/Desktop/h52/pages/search/search.vue?2ce0","webpack:///C:/Users/love/Desktop/h52/pages/search/search.vue?29c6","webpack:///C:/Users/love/Desktop/h52/pages/search/search.vue?b1e2","webpack:///C:/Users/love/Desktop/h52/pages/search/search.vue?ec91","uni-app:///pages/search/search.vue"],"names":["createPage","Page","renderjs","component","options","__file","components","uniPopup","render","_vm","this","_h","$createElement","_self","_c","_isMounted","e0","$event","uni","navigateBack","delta","recyclableRender","staticRenderFns","_withStripped"],"mappings":";;;;2DAAA,q2BAAssC,eAAG,G;;;;;;;;wECAzsC,qBACA,sBACA,2C,mDACAA,EAAWC,a;;;;2DCHX,8SACIC,EADJ,iHASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,0BACZ,aAAAF,E;;;;2GCvBf,8zB;;;;2GCAA,8LAAIG,EAAa,CACfC,SAAU,WACR,OAAO,8LAKPC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,GACdL,EAAIM,aACPN,EAAIO,GAAK,SAASC,GAChB,OAAOR,EAAIS,IAAIC,aAAa,CAC1BC,MAAO,OAKXC,GAAmB,EACnBC,EAAkB,GACtBd,EAAOe,eAAgB,G;;;;2DCrBvB,seAA8oB,eAAG,G;;;;yMCsDjpB,gD,+hBAGA,CACA,KADA,WAEA,OACA,cACA,cACA,UACA,cACA,cACA,OACA,cACA,iBACA,8CACA,2CACA,aACA,aACA,cACA,iBACA,kBAEA,cAEA,oBAIA,YACA,QAEA,SACA,IADA,WAEA,wCAEA,gBAJA,WAIA,WACA,kCAEA,sCACA,qBACA,YACA,eACA,2BACA,gBACA,2BACA,mEACA,4BACA,oCACA,2GACA,UACA,iFACA,SAIA,SAxBA,SAwBA,GAIA,IAHA,SACA,oBACA,eACA,YACA,6BAEA,uBAEA,iBAjCA,WAiCA,WACA,gBACA,yCACA,MACA,wBACA,uBACA,+BAIA,YADA,yBAFA,sBAKA,cACA,qBACA,eACA,eAEA,uBACA,oBACA,MAEA,wBACA,gBAEA,sBACA,gBAEA,sBACA,gBAEA,2BAIA,cAnEA,WAmEA,WACA,kCAGA,oCACA,eACA,wBACA,OACA,QACA,mBAEA,UACA,uBACA,aACA,mBACA,YACA,YAEA,MACA,SACA,8BACA,eACA,yBAGA,uCACA,6CAEA,mCACA,oBACA,kCAGA,wBACA,mBACA,iBACA,gBACA,MACA,SACA,8BACA,eACA,aAIA,eACA,mCAEA,IAEA,kCAEA,iBACA,gBACA,MACA,SACA,8BACA,eACA,2BAIA,MAGA,aApIA,WAoIA,WACA,gBACA,WACA,uBACA,wBACA,8BACA,2BACA,yBAGA,IAMA,GALA,gBACA,sEACA,+BACA,wCACA,4BACA,kBAEA,YADA,+BAGA,SACA,sBAEA,YADA,+BAMA,+DACA,uBACA,cACA,SACA,WAEA,kBACA,QAEA,mBACA,YAEA,4BAoBA,OANA,yFACA,sEAEA,0CAEA,8CAlBA,uBACA,CACA,SACA,WAEA,YACA,QAEA,YACA,QAaA,kBACA,+BAEA,8DACA,6CAEA,UAKA,wDAEA,yCACA,sDACA,sBAGA,cACA,iBACA,eACA,uCACA,sBAEA,yCACA,sBAIA,WAhOA,SAgOA,GACA,oBACA,eAEA,gBAGA,WAvOA,WAwOA,mBACA,gBAEA,YA3OA,WA2OA,WACA,2BACA,2BAGA,SAhPA,SAgPA,GACA,kBACA,YACA,eACA,sBAGA,gBAvPA,SAuPA,GACA,cACA,gDAIA,OA7PA,SA6PA,GACA,4BAGA,QAjQA,WAiQA,yHACA,kBACA,wBAFA,8CAKA,cAtQA,WAsQA,WACA,oBACA,wCACA,WACA,aACA,aACA,gBACA,qBACA,wBACA,iBACA,kBACA,eACA,kBACA,8BACA,wBACA,aACA,cACA,eAIA,aACA,qBACA,kBAMA,cAnSA,WAmSA,WACA,oBACA,wCACA,WACA,aACA,aACA,gBACA,uBACA,kBACA,eACA,mBACA,8BAMA,cApTA,WAoTA,WACA,oBACA,wCACA,WACA,aACA,aACA,gBACA,oBACA,kBACA,eACA,mBACA,+BAOA,OAlWA,WAmWA,qBACA,iD","file":"pages/search/search.js","sourcesContent":["import mod from \"-!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--10-oneOf-1-0!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-1!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-2!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--10-oneOf-1-3!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\less-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-4!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-5!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./search.vue?vue&type=style&index=0&id=4cedc0c6&lang=less&scoped=true&\"; export default mod; export * from \"-!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--10-oneOf-1-0!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-1!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-2!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--10-oneOf-1-3!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\less-loader\\\\dist\\\\cjs.js??ref--10-oneOf-1-4!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--10-oneOf-1-5!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./search.vue?vue&type=style&index=0&id=4cedc0c6&lang=less&scoped=true&\"","import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/search/search.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./search.vue?vue&type=template&id=4cedc0c6&scoped=true&\"\nvar renderjs\nimport script from \"./search.vue?vue&type=script&lang=js&\"\nexport * from \"./search.vue?vue&type=script&lang=js&\"\nimport style0 from \"./search.vue?vue&type=style&index=0&id=4cedc0c6&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"4cedc0c6\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/search/search.vue\"\nexport default component.exports","export * from \"-!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./search.vue?vue&type=template&id=4cedc0c6&scoped=true&\"","var components = {\n  uniPopup: function() {\n    return import(\n      /* webpackChunkName: \"components/uni-popup/uni-popup\" */ \"@/components/uni-popup/uni-popup.vue\"\n    )\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event) {\n      return _vm.uni.navigateBack({\n        delta: 1\n      })\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./search.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\我的应用\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./search.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view class=\"search\">\r\n\t\t<view class=\"search-header\">\r\n\t\t\t<Head title=\"搜索商品\" :bgColor=\"'#f4f4f4'\"></Head>\r\n\t\t\t<view class=\"\" :style=\"{height:nav_height+'px',width:'100%'}\"></view>\r\n\t\t\t<view class=\"search-header-main\">\r\n\t\t\t\t<image src=\"../../static/img/img_news.png\" @click=\"recorderInit\" mode=\"\"></image>\r\n\t\t\t\t<view class=\"search-header-main-c d-flex j-sb a-center\">\r\n\t\t\t\t\t<image @click=\"searchProduct\" style=\"width: 48upx;height: 48upx;margin-left: 20upx;\" src=\"../../static/img/icon-搜索备份@2x.png\" mode=\"\"></image>\r\n\t\t\t\t\t<input style=\"flex: 1;\" type=\"text\" v-model.trim=\"search_inp\" @input = \"inputClick\" placeholder=\"搜索商品\" />\r\n\t\t\t\t\t<image v-if=\"is_can\" @click=\"clearClick\" style=\"width: 48upx;height: 48upx;margin-right: 20upx;\" src=\"../../static/img/cha.png\" mode=\"\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"search-header-main-r\" @click=\"uni.navigateBack({delta:1})\">取消</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view class=\"search-content\">\r\n\t\t\t<view v-if=\"productArr.length == 0\" class=\"abb\">\r\n\t\t\t\t<view class=\"search-content-top d-flex j-sb\">\r\n\t\t\t\t\t<view class=\"\">历史搜索</view>\r\n\t\t\t\t\t<image @click=\"togglePopup\" style=\"width: 40upx;height: 40upx;\" src=\"../../static/img/img_delete.png\" mode=\"\"></image>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"search-content-main\">\r\n\t\t\t\t\t<view class=\"search-content-main-item\" @click=\"btnClick(item)\" v-for=\" (item,index) in histrayArr \" :key=\"index\"> {{item}}</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<scroll-view v-else class=\"avv\" scroll-y='true' style=\"height: 100%;\" >\r\n\t\t\t\t<view  class=\"similar-content-main\">\r\n\t\t\t\t\t<view class=\"similar-product-list\"  v-for=\"(item,index) in productArr\" :key= index @click=\"jumpGoodsDetail(item.id)\">\r\n\t\t\t\t\t\t<image :src=\"item.image_url\" mode=\"\"></image>\r\n\t\t\t\t\t\t<view class=\"pro-name\"> {{item.product_title}}</view>\r\n\t\t\t\t\t\t<view class=\"shop\">官方授权 品牌直营</view>\r\n\t\t\t\t\t\t<view class=\"pro-price d-flex a-center j-sb\">\r\n\t\t\t\t\t\t\t<view class=\"\" style=\"font-size: 24upx;color: #FA6E39;\">￥{{item.price}}</view>\r\n\t\t\t\t\t\t\t<view class=\"\" style=\"font-size: 20upx;color: #BABABA;\">销量：{{item.volume}}件</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</scroll-view>\r\n\t\t</view>\r\n\t\t<uni-popup ref=\"showtip\" :type=\"type\" :mask-click=\"false\" >\r\n\t\t\t<view class=\"uni-tip\">\r\n\t\t\t\t<!-- <text class=\"uni-tip-title\">提示</text> -->\r\n\t\t\t\t<text class=\"uni-tip-content\">是否确认删除历史搜索？</text>\r\n\t\t\t\t<view class=\"uni-tip-group-button\">\r\n\t\t\t\t\t<text class=\"uni-tip-button\" @click=\"cancel()\">取消</text>\r\n\t\t\t\t\t<text style=\"color:#FA6E39\" class=\"uni-tip-button\" @click=\"confirm()\">确定</text>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\n</template>\n\n<script>\r\n\timport Head from \"@/components/head.vue\"\r\n\timport CryptoJS from '@/utils/crypto-js/crypto-js.js'\r\n\t// import  TransWorker from  \"@/utils/yuyin/transcode.worker.js\"\r\n\t// console.log('TransWorker',TransWorker)\r\n\texport default{\r\n\t\tdata(){\r\n\t\t\treturn{\r\n\t\t\t\tnav_height:'',\r\n\t\t\t\tsearch_inp:'',//搜索内容\r\n\t\t\t\tis_can:false,\r\n\t\t\t\thistrayArr:[],//历史搜索\r\n\t\t\t\ttype:'center',\r\n\t\t\t\tpage:1,\r\n\t\t\t\tproductArr:[],\r\n\t\t\t\tAPPID:'5fbf4040',\r\n\t\t\t\tAPI_SECRET:'868b5d7705092ecc855399c5c478398b',\r\n\t\t\t\tAPI_KEY:'3c8e91bf904901f722be7bc08b112c8f',\r\n\t\t\t\twebSocket:'',\r\n\t\t\t\taudioData:[],//记录音频数据\r\n\t\t\t\tstatus: 'null',\r\n\t\t\t    language:'zh_cn',\r\n\t\t\t    accent:'mandarin',\r\n\t\t\t\t// 记录听写结果\r\n\t\t\t\tresultText:'',\r\n\t\t\t\t// wpgs下的听写结果需要中间状态辅助记录\r\n\t\t\t\t resultTextTemp:'',\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t},\r\n\t\tcomponents:{\r\n\t\t\tHead\r\n\t\t},\r\n\t\tmethods:{\r\n\t\t\tabb(){\r\n\t\t\t  console.log('TransWorker',TransWorker)\r\n\t\t\t},\r\n\t\t\tgetWebSocketUrl() {\r\n\t\t\t  return new Promise((resolve, reject) => {\r\n\t\t\t    // 请求地址根据语种不同变化\r\n\t\t\t    var url = 'wss://iat-api.xfyun.cn/v2/iat'\r\n\t\t\t    var host = 'iat-api.xfyun.cn'\r\n\t\t\t    var apiKey = this.API_KEY\r\n\t\t\t    var apiSecret = this.API_SECRET\r\n\t\t\t    var date = new Date().toGMTString()\r\n\t\t\t    var algorithm = 'hmac-sha256'\r\n\t\t\t    var headers = 'host date request-line'\r\n\t\t\t    var signatureOrigin = `host: ${host}\\ndate: ${date}\\nGET /v2/iat HTTP/1.1`\r\n\t\t\t    var signatureSha = CryptoJS.HmacSHA256(signatureOrigin, apiSecret)\r\n\t\t\t    var signature = CryptoJS.enc.Base64.stringify(signatureSha)\r\n\t\t\t    var authorizationOrigin = `api_key=\"${apiKey}\", algorithm=\"${algorithm}\", headers=\"${headers}\", signature=\"${signature}\"`\r\n\t\t\t    var authorization = btoa(authorizationOrigin)\r\n\t\t\t    url = `${url}?authorization=${authorization}&date=${date}&host=${host}`\r\n\t\t\t    resolve(url)\r\n\t\t\t\t\r\n\t\t\t  })\r\n\t\t\t},\r\n\t\t\t toBase64(buffer) {\r\n\t\t\t    var binary = ''\r\n\t\t\t    var bytes = new Uint8Array(buffer)\r\n\t\t\t    var len = bytes.byteLength\r\n\t\t\t    for (var i = 0; i < len; i++) {\r\n\t\t\t      binary += String.fromCharCode(bytes[i])\r\n\t\t\t    }\r\n\t\t\t    return window.btoa(binary)\r\n\t\t\t  },\r\n\t\t\tconnectWebSocket(){\r\n\t\t\t\tconsole.log(66)\r\n\t\t\t\t this.getWebSocketUrl().then(url => {\r\n\t\t\t\t      let iatWS\r\n\t\t\t\t      if ('WebSocket' in window) {\r\n\t\t\t\t        iatWS = new WebSocket(url)\r\n\t\t\t\t      } else if ('MozWebSocket' in window) {\r\n\t\t\t\t        iatWS = new MozWebSocket(url)\r\n\t\t\t\t      } else {\r\n\t\t\t\t\t\t\talert('浏览器不支持WebSocket')\r\n\t\t\t\t\t\t\treturn \r\n\t\t\t\t      }\r\n\t\t\t\t\t   this.webSocket = iatWS\r\n\t\t\t\t\t\tiatWS.onopen = e => {\r\n\t\t\t\t\t\t console.log(e)\r\n\t\t\t\t\t\t console.log(1)\r\n\t\t\t\t\t\t   // 重新开始录音\r\n\t\t\t\t\t\t\t setTimeout(() => {\r\n\t\t\t\t\t\t\t   this.webSocketSend()\r\n\t\t\t\t\t\t\t }, 500)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tiatWS.onmessage = e => {\r\n\t\t\t\t\t\t  console.log(2)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tiatWS.onerror = e => {\r\n\t\t\t\t\t\t\tconsole.log(3)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tiatWS.onclose = e => {\r\n\t\t\t\t\t\t  console.log(4)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t  console.log('iatWS',iatWS)\r\n\t\t\t\t  })\r\n\t\t\t},\r\n\t\t\t// 向webSocket发送数据\r\n\t\t    webSocketSend() {\r\n\t\t\t    if (this.webSocket.readyState !== 1) {\r\n\t\t\t      return\r\n\t\t\t    }\r\n\t\t\t    let audioData = this.audioData.splice(0, 1280)\r\n\t\t\t\tconsole.log(audioData)\r\n\t\t\t\tconsole.log(this.APPID)\r\n\t\t\t    var params = {\r\n\t\t\t      common: {\r\n\t\t\t        app_id: this.APPID,\r\n\t\t\t      },\r\n\t\t\t      business: {\r\n\t\t\t        language: this.language, //小语种可在控制台--语音听写（流式）--方言/语种处添加试用\r\n\t\t\t        domain: 'iat',\r\n\t\t\t        accent: this.accent, //中文方言可在控制台--语音听写（流式）--方言/语种处添加试用\r\n\t\t\t        vad_eos: 5000,\r\n\t\t\t        dwa: 'wpgs', //为使该功能生效，需到控制台开通动态修正功能（该功能免费）\r\n\t\t\t      },\r\n\t\t\t      data: {\r\n\t\t\t        status: 0,\r\n\t\t\t        format: 'audio/L16;rate=16000',\r\n\t\t\t        encoding: 'raw',\r\n\t\t\t        audio: this.toBase64(audioData),\r\n\t\t\t      },\r\n\t\t\t    }\r\n\t\t\t    this.webSocket.send(JSON.stringify(params))\r\n\t\t\t    this.handlerInterval = setInterval(() => {\r\n\t\t\t      // websocket未连接\r\n\t\t\t      if (this.webSocket.readyState !== 1) {\r\n\t\t\t        this.audioData = []\r\n\t\t\t        clearInterval(this.handlerInterval)\r\n\t\t\t        return\r\n\t\t\t      }\r\n\t\t\t      if (this.audioData.length === 0) {\r\n\t\t\t        if (this.status === 'end') {\r\n\t\t\t          this.webSocket.send(\r\n\t\t\t            JSON.stringify({\r\n\t\t\t              data: {\r\n\t\t\t                status: 2,\r\n\t\t\t                format: 'audio/L16;rate=16000',\r\n\t\t\t                encoding: 'raw',\r\n\t\t\t                audio: '',\r\n\t\t\t              },\r\n\t\t\t            })\r\n\t\t\t          )\r\n\t\t\t          this.audioData = []\r\n\t\t\t          clearInterval(this.handlerInterval)\r\n\t\t\t        }\r\n\t\t\t        return false\r\n\t\t\t      }\r\n\t\t\t      audioData = this.audioData.splice(0, 1280)\r\n\t\t\t      // 中间帧\r\n\t\t\t      this.webSocket.send(\r\n\t\t\t        JSON.stringify({\r\n\t\t\t          data: {\r\n\t\t\t            status: 1,\r\n\t\t\t            format: 'audio/L16;rate=16000',\r\n\t\t\t            encoding: 'raw',\r\n\t\t\t            audio: this.toBase64(audioData),\r\n\t\t\t          },\r\n\t\t\t        })\r\n\t\t\t      )\r\n\t\t\t    }, 40)\r\n\t\t\t  },\r\n\t\t\t // 初始化浏览器录音\r\n\t\t recorderInit() {\r\n\t\t\t console.log(11)\r\n\t\t\t       this.abb()\r\n\t\t\t        navigator.getUserMedia =\r\n\t\t\t        navigator.getUserMedia ||\r\n\t\t\t        navigator.webkitGetUserMedia ||\r\n\t\t\t        navigator.mozGetUserMedia ||\r\n\t\t\t        navigator.msGetUserMedia\r\n\t\t\t      \r\n\t\t\t      // 创建音频环境\r\n\t\t\t      try {\r\n\t\t\t\t\tconsole.log(22)\r\n\t\t\t        this.audioContext = new (window.AudioContext || window.webkitAudioContext)()\r\n\t\t\t\t\tconsole.log(this.audioContext)\r\n\t\t\t\t\tconsole.log(this.audioContext.resume())\r\n\t\t\t        this.audioContext.resume()\r\n\t\t\t        if (!this.audioContext) {\r\n\t\t\t          alert('浏览器不支持webAudioApi相关接口')\r\n\t\t\t          return\r\n\t\t\t        }\r\n\t\t\t      } catch (e) {\r\n\t\t\t        if (!this.audioContext) {\r\n\t\t\t          alert('浏览器不支持webAudioApi相关接口')\r\n\t\t\t          return\r\n\t\t\t        }\r\n\t\t\t      }\r\n\t\t\t      \r\n\t\t\t      // 获取浏览器录音权限\r\n\t\t\t      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\r\n\t\t\t        navigator.mediaDevices\r\n\t\t\t          .getUserMedia({\r\n\t\t\t            audio: true,\r\n\t\t\t            video: false,\r\n\t\t\t          })\r\n\t\t\t          .then(stream => {\r\n\t\t\t            getMediaSuccess(stream)\r\n\t\t\t          })\r\n\t\t\t          .catch(e => {\r\n\t\t\t            getMediaFail(e)\r\n\t\t\t          })\r\n\t\t\t      } else if (navigator.getUserMedia) {\r\n\t\t\t        navigator.getUserMedia(\r\n\t\t\t          {\r\n\t\t\t            audio: true,\r\n\t\t\t            video: false,\r\n\t\t\t          },\r\n\t\t\t          stream => {\r\n\t\t\t            getMediaSuccess(stream)\r\n\t\t\t          },\r\n\t\t\t          function(e) {\r\n\t\t\t            getMediaFail(e)\r\n\t\t\t          }\r\n\t\t\t        )\r\n\t\t\t      } else {\r\n\t\t\t        if (navigator.userAgent.toLowerCase().match(/chrome/) && location.origin.indexOf('https://') < 0) {\r\n\t\t\t          alert('chrome下获取浏览器录音功能，因为安全性问题，需要在localhost或127.0.0.1或https下才能获取权限')\r\n\t\t\t        } else {\r\n\t\t\t          alert('无法获取浏览器录音功能，请升级浏览器或使用chrome')\r\n\t\t\t        }\r\n\t\t\t        this.audioContext && this.audioContext.close()\r\n\t\t\t        return\r\n\t\t\t      }\r\n\t\t\t      // 获取浏览器录音权限成功的回调\r\n\t\t\t      let getMediaSuccess = stream => {\r\n\t\t\t        console.log('getMediaSuccess')\r\n\t\t\t        // 创建一个用于通过JavaScript直接处理音频\r\n\t\t\t        this.scriptProcessor = this.audioContext.createScriptProcessor(0, 1, 1)\r\n\t\t\t        this.scriptProcessor.onaudioprocess = e => {\r\n\t\t\t          // 去处理音频数据\r\n\t\t\t          if (this.status === 'ing') {\r\n\t\t\t            // transWorker.postMessage(e.inputBuffer.getChannelData(0))\r\n\t\t\t          }\r\n\t\t\t        }\r\n\t\t\t        // 创建一个新的MediaStreamAudioSourceNode 对象，使来自MediaStream的音频可以被播放和操作\r\n\t\t\t        this.mediaSource = this.audioContext.createMediaStreamSource(stream)\r\n\t\t\t        // 连接\r\n\t\t\t        this.mediaSource.connect(this.scriptProcessor)\r\n\t\t\t        this.scriptProcessor.connect(this.audioContext.destination)\r\n\t\t\t        this.connectWebSocket()\r\n\t\t\t      }\r\n\t\t\t  \r\n\t\t\t      let getMediaFail = (e) => {\r\n\t\t\t        alert('请求麦克风失败')\r\n\t\t\t        console.log(e)\r\n\t\t\t        this.audioContext && this.audioContext.close()\r\n\t\t\t        this.audioContext = undefined\r\n\t\t\t        // 关闭websocket\r\n\t\t\t        if (this.webSocket && this.webSocket.readyState === 1) {\r\n\t\t\t          this.webSocket.close()\r\n\t\t\t        }\r\n\t\t\t      }\r\n\t\t\t    },\r\n\t\t\tinputClick(val){\r\n\t\t\t\tif(val.detail.value !== \"\"){\r\n\t\t\t\t\tthis.is_can = true\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.is_can = false\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tclearClick(){\r\n\t\t\t\tthis.search_inp = \"\"\r\n\t\t\t\tthis.is_can = false\r\n\t\t\t},\r\n\t\t\ttogglePopup() {\r\n\t\t\t\tthis.$nextTick(() => {\r\n\t\t\t\t\tthis.$refs.showtip.open()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tbtnClick(val){\r\n\t\t\t\tthis.search_inp = val\r\n\t\t\t\tthis.page = 1\r\n\t\t\t\tthis.is_can = true\r\n\t\t\t\tthis.searchProduct()\r\n\t\t\t},\r\n\t\t\t//跳转到商品详情页面\r\n\t\t\tjumpGoodsDetail(id){\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl:`/pages/goods/goodsDetail?id=${id}`\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//取消\r\n\t\t\tcancel(type) {\r\n\t\t\t\tthis.$refs.showtip.close()\r\n\t\t\t},\r\n\t\t\t//确定\r\n\t\t\tasync confirm(){\r\n\t\t\t\tthis.cancelHistory()\r\n\t\t\t    this.$refs.showtip.close()\r\n\t\t\t},\r\n\t\t\t//搜索商品\r\n\t\t\tsearchProduct(){\r\n\t\t\t\tthis.$http.post('',{\r\n\t\t\t\t\taccess_id:uni.getStorageSync('access_id'),\r\n\t\t\t\t\tstore_id:1,\r\n\t\t\t\t\tstore_type:2,\r\n\t\t\t\t\tmodule:'app',\r\n\t\t\t\t\taction:'search',\r\n\t\t\t\t\tapp:'product_search',\r\n\t\t\t\t\tkeyword:this.search_inp,\r\n\t\t\t\t\tpage:this.page\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif(res.data.code == 200){\r\n\t\t\t\t\t\tthis.productArr = res.data.data.data\r\n\t\t\t\t\t\tif(this.productArr.length == 0){\r\n\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\ttitle:'没有此商品',\r\n\t\t\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\ttitle:res.data.message,\r\n\t\t\t\t\t\t\ticon:'none'\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t//获取历史搜索 \r\n\t\t\thistorysearch(){\r\n\t\t\t\tthis.$http.post('',{\r\n\t\t\t\t\taccess_id:uni.getStorageSync('access_id'),\r\n\t\t\t\t\tstore_id:1,\r\n\t\t\t\t\tstore_type:2,\r\n\t\t\t\t\tmodule:'app',\r\n\t\t\t\t\taction:'search',\r\n\t\t\t\t\tapp:'search_history'\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif(res.data.code == 200){\r\n\t\t\t\t\t\tthis.histrayArr = res.data.data\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t},\r\n\t\t\t//删除历史搜索 \r\n\t\t\tcancelHistory(){\r\n\t\t\t\tthis.$http.post('',{\r\n\t\t\t\t\taccess_id:uni.getStorageSync('access_id'),\r\n\t\t\t\t\tstore_id:1,\r\n\t\t\t\t\tstore_type:2,\r\n\t\t\t\t\tmodule:'app',\r\n\t\t\t\t\taction:'search',\r\n\t\t\t\t\tapp:'del_history'\r\n\t\t\t\t}).then(res=>{\r\n\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\tif(res.data.code == 200){\r\n\t\t\t\t\t\tthis.histrayArr = res.data.data\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t\t\r\n\t\t},\r\n\t\tonLoad() {\r\n\t\t\tthis.historysearch()\r\n\t\t\tthis.nav_height = uni.getStorageSync(\"nav_height\")\r\n\t\t}\r\n\t}\n</script>\n\n<style lang=\"less\" scoped>\r\n\t.search{\r\n\t\theight: 100%;\r\n\t\twidth: 100%;\r\n\t\tbackground: #FFFFFF;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t}\r\n\t.search-header{\r\n\t\t\r\n\t}\r\n\t.search-header-main{\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-around;\r\n\t\talign-items: center;\r\n\t\tbackground: #f4f4f4;\r\n\t\theight: 108upx;\r\n\t\twidth: 100%;\r\n\t\t>image{\r\n\t\t\theight: 60upx;\r\n\t\t\twidth: 60upx;\r\n\t\t}\r\n\t\t&-c{\r\n\t\t\twidth: 530upx;\r\n\t\t\theight: 68upx;\r\n\t\t\tbackground: #FFFFFF;\r\n\t\t\tborder-radius: 34upx;\r\n\t\t}\r\n\t\t&-r{\r\n\t\t\tfont-size: 30upx;\r\n\t\t\tfont-weight: 500;\r\n\t\t\tcolor: #333333;\r\n\t\t\tline-height: 42upx;\r\n\t\t\tmargin-right: 10upx;\r\n\t\t}\r\n\t}\r\n\t.search-content{\r\n\t\twidth: 100%;\r\n\t\tflex: 1;\r\n\t\theight: 100%;\r\n\t\toverflow: hidden;\r\n\t\tbackground: #f4f4f4;\r\n\t\t.abb{\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t\tbackground: #FFFFFF;\r\n\t\t}\r\n\t\t&-top{\r\n\t\t\theight: 80upx;\r\n\t\t\twidth: 100%;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tpadding: 20upx 30upx;\r\n\t\t}\r\n\t\t&-main{\r\n\t\t\twidth: 100%;\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-wrap: wrap;\r\n\t\t\t.search-content-main-item{\r\n\t\t\t\tmin-width: 50upx;\r\n\t\t\t\theight: 60upx;\r\n\t\t\t\tbackground: #F4F4F4;\r\n\t\t\t\tborder-radius: 30upx;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tpadding: 0 20upx;\r\n\t\t\t\tmargin-left: 15upx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t.avv{\r\n\t\t\r\n\t\twidth: 100%;\r\n\t\theight: 100%\r\n\t}\r\n\t.similar-content-main{\r\n\t\tdisplay: flex;\r\n\t\tflex-wrap: wrap;\r\n\t\tjustify-content: space-between;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t\tbox-sizing: border-box;\r\n\t\tpadding: 0 30upx;\r\n\t\tbackground: #f4f4f4;\r\n\t\t\r\n\t\t.similar-product-list{\r\n\t\t\tborder-radius: 20upx;\r\n\t\t\tbackground: #FFFFFF;\r\n\t\t\twidth: 336upx;\r\n\t\t\tmargin-bottom: 20upx;\r\n\t\t\timage{\r\n\t\t\t\theight: 336upx;\r\n\t\t\t\twidth: 336upx;\r\n\t\t\t\tborder-radius: 20upx 20upx 0 0;\r\n\t\t\t}\r\n\t\t\t>view{\r\n\t\t\t\tmargin: 20upx;\r\n\t\t\t}\r\n\t\t\t.pro-name{\r\n\t\t\t\tfont-size: 32upx;\r\n\t\t\t\tfont-weight: 400;\r\n\t\t\t\tcolor: #333333;\r\n\t\t\t\tline-height: 44upx;\r\n\t\t\t\twidth: 80%;\r\n\t\t\t\toverflow : hidden;\r\n\t\t\t\ttext-overflow: ellipsis;\r\n\t\t\t\tdisplay: -webkit-box;\r\n\t\t\t\t-webkit-line-clamp: 2;\r\n\t\t\t\t-webkit-box-orient: vertical;\r\n\t\t\t}\r\n\t\t\t.shop{\r\n\t\t\t\tfont-size: 24upx;\r\n\t\t\t\tfont-weight: 400;\r\n\t\t\t\tcolor: #999999;\r\n\t\t\t\tline-height: 34upx;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/* 提示窗口 */\r\n\t\t.uni-tip {\r\n\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\t/* #endif */\r\n\t\t\tpadding: 15px;\r\n\t\t\twidth: 300px;\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tborder-radius: 10px;\r\n\t\t}\r\n\t\r\n\t\t.uni-tip-title {\r\n\t\t\tmargin-bottom: 10px;\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-weight: bold;\r\n\t\t\tfont-size: 16px;\r\n\t\t\tcolor: #333;\r\n\t\t}\r\n\t\r\n\t\t.uni-tip-content {\r\n\t\t\t/* padding: 15px;\r\n\t*/\r\n\t\t\tfont-size: 14px;\r\n\t\t\tcolor: #666;\r\n\t\t\ttext-align: center;\r\n\t\t}\r\n\t\t.uni-tip-group-button {\r\n\t\t\t/* #ifndef APP-NVUE */\r\n\t\t\tdisplay: flex;\r\n\t\t\t/* #endif */\r\n\t\t\tflex-direction: row;\r\n\t\t\tmargin-top: 20px;\r\n\t\t}\r\n\t\t\r\n\t\t.uni-tip-button {\r\n\t\t\tflex: 1;\r\n\t\t\ttext-align: center;\r\n\t\t\tfont-size: 14px;\r\n\t\t\tcolor: #3b4144;\r\n\t\t}\r\n\t\t/deep/.scroll-view-item_H ::-webkit-scrollbar { /* 隐藏滚动条，但依旧具备可以滚动的功能 */ display: none; width: 0; height: 0; color: transparent; background: transparent; }\r\n\t\t /deep/::-webkit-scrollbar { display: none; width: 0; height: 0; color: transparent; background: transparent; }\n</style>\n"],"sourceRoot":""}